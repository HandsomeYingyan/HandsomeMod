From c670b8649f2ff2b899e33113c3f509e5820f575b Mon Sep 17 00:00:00 2001
Message-Id: <c670b8649f2ff2b899e33113c3f509e5820f575b.1587150132.git.zanussi@kernel.org>
In-Reply-To: <05c07aad7517537dec221029782bf891341897c5.1587150132.git.zanussi@kernel.org>
References: <05c07aad7517537dec221029782bf891341897c5.1587150132.git.zanussi@kernel.org>
From: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
Date: Wed, 13 Dec 2017 12:44:14 +0100
Subject: [PATCH 177/506] mm/slub: close possible memory-leak in
 kmem_cache_alloc_bulk()

Under certain circumstances we could leak elements which were moved to
the local "to_free" list. The damage is limited since I can't find
any users here.

Cc: stable-rt@vger.kernel.org
Signed-off-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de>
---
 mm/slub.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/mm/slub.c b/mm/slub.c
index 516cb47f0d5d..606399cb9f72 100644
--- a/mm/slub.c
+++ b/mm/slub.c
@@ -3237,6 +3237,7 @@ int kmem_cache_alloc_bulk(struct kmem_cache *s, gfp_t flags, size_t size,
 	return i;
 error:
 	local_irq_enable();
+	free_delayed(&to_free);
 	slab_post_alloc_hook(s, flags, i, p);
 	__kmem_cache_free_bulk(s, i, p);
 	return 0;
-- 
2.17.1

